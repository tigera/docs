### Push {{prodname}} images to your private registry image path

In order to install images from your private registry, you must first pull the images from Tigera's registry, re-tag them with your own registry, and then push the newly tagged images to your own registry.

1. Use the following commands to pull the required {{prodname}} images.

   ```bash
   docker pull {{releases.0.tigera-operator.registry}}/{{releases.0.tigera-operator.image}}:{{releases.0.tigera-operator.version}}
   {% for component in releases.0.components -%}
   {% if component[1].image -%}
   {% unless component[1].image contains "-windows" -%}
   {% if component[1].registry %}{% assign registry = component[1].registry | append: "/" %}{% else %}{% assign registry = page.registry -%} {% endif -%}
   docker pull {{ registry }}{{ component[1].image }}:{{component[1].version}}
   {% endunless -%}
   {% endif -%}
   {% endfor -%}
   ```

   For hybrid Linux + Windows clusters, pull the following Windows images.

   ```bash
   {% for component in releases.0.components -%}
   {% if component[1].image contains "-windows" -%}
   docker pull {{ registry }}{{ component[1].image }}:{{ component[1].version }}
   {% endif -%}
   {% endfor -%}
   ```

1. Retag the images with the name of your private registry `$PRIVATE_REGISTRY` and `$IMAGE_PATH`.

   ```bash
   docker tag {{releases.0.tigera-operator.registry}}/{{releases.0.tigera-operator.image}}:{{releases.0.tigera-operator.version}} $PRIVATE_REGISTRY/$IMAGE_PATH/{{releases.0.tigera-operator.image | split: "/" | last}}:{{releases.0.tigera-operator.version}}
   {% for component in releases.0.components -%}
   {% if component[1].image -%}
   {% unless component[1].image contains "-windows" -%}
   {% if component[1].registry %}{% assign registry = component[1].registry | append: "/" %}{% else %}{% assign registry = page.registry -%} {% endif -%}
   docker tag {{ registry }}{{ component[1].image }}:{{component[1].version}} $PRIVATE_REGISTRY/$IMAGE_PATH/{{ component[1].image | split: "/" | last }}:{{component[1].version}}
   {% endunless -%}
   {% endif -%}
   {% endfor -%}
   ```

   For hybrid Linux + Windows clusters, retag the following Windows images with the name of your private registry.

   ```bash
   {% for component in releases.0.components -%}
   {% if component[1].image contains "-windows" -%}
   docker tag {{ registry }}{{ component[1].image }}:{{ component[1].version }} $PRIVATE_REGISTRY/$IMAGE_PATH/{{ component[1].image | split: "/" | last }}:{{ component[1].version }}
   {% endif -%}
   {% endfor -%}
   ```

1. Push the images to your private registry.

   ```bash
   docker push $PRIVATE_REGISTRY/$IMAGE_PATH/{{releases.0.tigera-operator.image | split: "/" | last}}:{{releases.0.tigera-operator.version}}
   {% for component in releases.0.components -%}
   {% if component[1].image -%}
   {% unless component[1].image contains "-windows" -%}
   docker push $PRIVATE_REGISTRY/$IMAGE_PATH/{{ component[1].image | split: "/" | last}}:{{component[1].version}}
   {% endunless -%}
   {% endif -%}
   {% endfor -%}
   ```

   For hybrid Linux + Windows clusters, push the following Windows images to your private registry.

   ```bash
   {% for component in releases.0.components -%}
   {% if component[1].image contains "-windows" -%}
   docker push $PRIVATE_REGISTRY/$IMAGE_PATH/{{ component[1].image | split: "/" | last}}:{{component[1].version}}
   {% endif -%}
   {% endfor -%}
   ```

   :::caution

   Do not push the private {{prodname}} images to a public registry.

   :::

### Run the operator using images from your private registry image path

Before applying `tigera-operator.yaml`, modify registry references to use your custom registry:

```bash
{% if page.registry != "quay.io/" -%}
sed -ie "s?{{registry}}.*/?$PRIVATE_REGISTRY/$IMAGE_PATH/?" tigera-operator.yaml
{% endif -%}
sed -ie "s?quay.io.*/?$PRIVATE_REGISTRY/$IMAGE_PATH/?" tigera-operator.yaml
```

<!-- The second 'sed' should be removed once operator launches Prometheus & Alertmanager -->

Next, ensure that an image pull secret has been configured for your custom registry. Set the enviroment variable `PRIVATE_REGISTRY_PULL_SECRET` to the secret name.
Then add the image pull secret to the operator deployment spec:

```bash
sed -ie "/serviceAccountName: tigera-operator/a \      imagePullSecrets:\n\      - name: $PRIVATE_REGISTRY_PULL_SECRET"  tigera-operator.yaml
```

If you are installing Prometheus operator as part of {{prodname}}, then before applying `tigera-prometheus-operator.yaml`, modify registry references to use your custom registry:

```bash
{% if page.registry != "quay.io/" -%}
sed -ie "s?{{registry}}.*/?$PRIVATE_REGISTRY/$IMAGE_PATH/?" tigera-prometheus-operator.yaml
{% endif -%}
sed -ie "s?quay.io.*/?$PRIVATE_REGISTRY/$IMAGE_PATH/?" tigera-prometheus-operator.yaml
sed -ie "/serviceAccountName: calico-prometheus-operator/a \      imagePullSecrets:\n\      - name: $PRIVATE_REGISTRY_PULL_SECRET"  tigera-prometheus-operator.yaml
```

<!-- The second 'sed' should be removed once operator launches Prometheus & Alertmanager -->

Before applying `custom-resources.yaml`, modify registry references to use your custom registry:

```bash
{% if page.registry != "quay.io/" -%}
sed -ie "s?{{registry}}.*/?$PRIVATE_REGISTRY/$IMAGE_PATH/?" custom-resources.yaml
{% endif -%}
sed -ie "s?quay.io.*/?$PRIVATE_REGISTRY/$IMAGE_PATH/?" custom-resources.yaml
```

<!-- The second 'sed' should be removed once operator launches Prometheus & Alertmanager -->

For <b>Openshift</b>, after downloading all manifests modify the following to use your custom registry:

```bash
{% if page.registry != "quay.io/" -%}
sed -ie "s?{{registry}}.*/?$PRIVATE_REGISTRY/$IMAGE_PATH/?" manifests/02-tigera-operator.yaml
{% endif -%}
sed -ie "s?quay.io.*/?$PRIVATE_REGISTRY/$IMAGE_PATH/?" manifests/02-tigera-operator.yaml
```

:::note

Add the image pull secret for your `registry` to the secret `tigera-pull-secret`

:::

### Configure the operator to use images from your private registry image path.

Set the `spec.registry` and `spec.imagePath` field of your Installation resource to the name of your custom registry. For example:

```
apiVersion: operator.tigera.io/v1
kind: Installation
metadata:
  name: default
spec:
  variant: TigeraSecureEnterprise
  imagePullSecrets:
    - name: tigera-pull-secret
  <b>registry: myregistry.com</b>
  <b>imagePath: my-image-path</b>
```
