---
description: API for this Calico Enterprise resource.
---

# Policy recommendations

import Servicematch from '@site/calico-enterprise_versioned_docs/version-3.16/_includes/content/_servicematch.mdx';

import Serviceaccountmatch from '@site/calico-enterprise_versioned_docs/version-3.16/_includes/content/_serviceaccountmatch.mdx';

import Ports from '@site/calico-enterprise_versioned_docs/version-3.16/_includes/content/_ports.mdx';

import Selectors from '@site/calico-enterprise_versioned_docs/version-3.16/_includes/content/_selectors.mdx';

import Entityrule from '@site/calico-enterprise_versioned_docs/version-3.16/_includes/content/_entityrule.mdx';

import Icmp from '@site/calico-enterprise_versioned_docs/version-3.16/_includes/content/_icmp.mdx';

import Rule from '@site/calico-enterprise_versioned_docs/version-3.16/_includes/content/_rule.mdx';

Policy recommendations are a kind of [staged network policy](/reference/resources/stagednetworkpolicy.mdx) that allow flows to and from a given namespace. New policy rules are generated by flows that are not captured by existing policies. 

The policy name is suffixed with `-recommendation` to differentiate it from other staged network policies. The naming scheme follows the pattern: 

`namespace-segmentation.<namespace>-recommendation`

where `namespace-segmentation` is the predefined tier name used for recommendations. 

If the Policy Recommendations resource is deleted, all recommendations with the state of learning or ignored, are also deleted. Activated policies (policies moved to the Policy Board in Manager UI) are not affected when the resource is deleted, and are handled like any other policy.

To apply changes to this resource, use the following format:

```
$ kubectl patch policyrecommendationscope default -p 
'{"spec":{"<parameter>":"<value>"}}'
```
**Example**

`$ kubectl patch policyrecommendationscope default -p '{"spec":{"interval":"5m"}}'`

## Sample YAML

This sample policy allows TBD...

```yaml
apiVersion: projectcalico.org/v3
kind: StagedNetworkPolicy
metadata:
  name: namespace-segmentation.my-namespace-recommendation
  namespace: my-namespace
  labels: "policyrecommendation.tigera.io/scope": "namespace"
  ownerreferences:
  - kind: "PolicyRecommendationScope"
spec:
  stagedAction: "Learning"
  tier: namespace-segmentation
  selector: "projectcalico.org/namespace == 'my-namespace'"
  types:
    - Ingress
    - Egress
  ingress:
    - action: Allow
  egress:
    - action: Allow
```

## Definition

### 

### Metadata

| Field            | Description                                                  | Accepted Values                                     | Schema | Default                                            |
| ---------------- | ------------------------------------------------------------ | --------------------------------------------------- | ------ | -------------------------------------------------- |
| name             | The name of the policy recommendation in the default namespace-segmentation tier. Required. | Alphanumeric string with optional `.`, `_`, or `-`. | string |                                                    |
| namespace        | Namespace provides an additional qualification to a resource name. |                                                     | string | "default"                                          |
| labels           |                                                              |                                                     |        |                                                    |
| owner references |                                                              |                                                     |        |                                                    |
| kind             | Run-time parameters for generating and updating policy recommendations, | PolicyRecommendationScope                           | Kind   | 10m stabilization period, 2.5m processing interval |


#### Kind values


| Field                  | Description                                                  | Accepted Values | Schema | Default        |
| ---------------------- | ------------------------------------------------------------ | --------------- | ------ | -------------- |
| Interval               | The frequency to create and refine policy recommendations.   |                 |        | 2.5m (minutes) |
| InitialLookback        | Start time to look at flow logs when first creating a policy recommendation. |                 |        | 24h (hours)    |
| StabilizationPeriod    | Time that a recommended policy should remain unchanged so it is stable and ready to be enforced. |                 |        | 10m (minutes)  |
| MaxRules               | The maximum number of rules that are permitted in the ingress or egress set. If the number of rules exceeds this limit, it is considered an error condition. |                 |        | 20             |
| PoliciesLearningCutoff | The total number of policy recommendations that can be in an active learning state before new recommendations can be added. Default: 20. |                 |        | 20             |



### Spec

| Field        | Description                                                  | Accepted Values     | Schema                | Default                                       |
| ------------ | ------------------------------------------------------------ | ------------------- | --------------------- | --------------------------------------------- |
| stagedAction |                                                              |                     | float                 |                                               |
| tier         | Name of the [tier](tier.mdx) this policy belongs to.         |                     | string                | `default`                                     |
| selector     | Selects the endpoints to which this policy applies.          |                     | [selector](#selector) | all()                                         |
| types        | Applies the policy based on the direction of the traffic. To apply the policy to inbound traffic, set to `Ingress`. To apply the policy to outbound traffic, set to `Egress`. To apply the policy to both, set to `Ingress, Egress`. | `Ingress`, `Egress` | List of strings       | Depends on presence of ingress/egress rules\* |
| ingress      | Ordered list of ingress rules applied by policy.             |                     | List of [Rule](#rule) |                                               |
| egress       | Ordered list of egress rules applied by this policy.         |                     | List of [Rule](#rule) |                                               |

\* If `types` has no value, {{prodname}} defaults as follows.

| Ingress Rules Present | Egress Rules Present | `Types` value     |
| --------------------- | -------------------- | ----------------- |
| No                    | No                   | `Ingress`         |
| Yes                   | No                   | `Ingress`         |
| No                    | Yes                  | `Egress`          |
| Yes                   | Yes                  | `Ingress, Egress` |


### Rule

Rules are generated only for `allow` flows that are not addressed by other policies defined in the cluster. Traffic originating from the recommendation namespace is used to generate egress rules, and traffic destined for the namespace is used to define ingress rules. 

<Rule />

### ICMP

<Icmp />

### EntityRule

<Entityrule global='false' />


### Selectors

Use a selector to specify the namespaces to create policy recommendations. By default, namespaces for Calico, Tigera, and Kubernetes namespaces are filtered out by prefix because they are covered by policies in the `allow-tigera` tier. 

The syntax is the same as the projectcalico.org resource [selectors](../../reference/resources/stagednetworkpolicy#selector).

```
Spec:
  NamespaceSpec:
    selector: '!(projectcalico.org/name starts with ''tigera-'')  && !(projectcalico.org/name starts with ''calico-'') && !(projectcalico.org/name starts with ''kube-'')'
```
Filter out namespaces by defining the namespaceSpec.selector:

```
$ kubectl patch policyrecommendationscope default -p '{"spec"{"namespaceSpec":{"selector":"'!(projectcalico.org/name starts with ''tigera-'')  && !(projectcalico.org/name starts with ''calico-'') && !(projectcalico.org/name starts with ''kube-'') && !(projectcalico.org/name starts with ''my-namespace'')'"}}}'
```

<Selectors />


### Ports

<Ports />

### ServiceAccountMatch

<Serviceaccountmatch />

### ServiceMatch

<Servicematch />

## Supported operations

| Datastore type           | Create/Delete | Update | Get/List | Notes |
| ------------------------ | ------------- | ------ | -------- | ----- |
| Kubernetes API datastore | Yes           | Yes    | Yes      |